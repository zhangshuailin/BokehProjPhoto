<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼¥æ•£åœ†å…¬å¼æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }
        
        .formula-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .controls {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }
        
        .control-group {
            margin-bottom: 25px;
        }
        
        .control-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 0.95em;
        }
        
        .control-group input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .control-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        
        .control-group input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
        }
        
        .value-display {
            display: inline-block;
            background: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            color: #667eea;
            margin-left: 10px;
            min-width: 80px;
            text-align: center;
        }
        
        .visualization {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
        }
        
        canvas {
            width: 100%;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .result-box {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .result-box h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .result-value {
            font-size: 2.5em;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .explanation {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 4px solid #2196f3;
        }
        
        .explanation h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .explanation p {
            color: #555;
            line-height: 1.6;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“· å¼¥æ•£åœ†å…¬å¼æ¼”ç¤º</h1>
        <p class="subtitle">Circle of Confusion - æ™¯æ·±è®¡ç®—çš„æ ¸å¿ƒæ¦‚å¿µ</p>
        
        <div class="formula-box">
            CoC = (|D - S| / D) Ã— (fÂ² / (N Ã— (S - f)))
        </div>
        
        <div class="content">
            <div class="controls">
                <h3 style="margin-bottom: 20px; color: #333;">ğŸ“ å‚æ•°æ§åˆ¶</h3>
                
                <div class="control-group">
                    <label>
                        å¯¹ç„¦è·ç¦» S (ç±³)
                        <span class="value-display" id="focusValue">3.0 m</span>
                    </label>
                    <input type="range" id="focusDistance" min="1" max="20" step="0.1" value="3">
                </div>
                
                <div class="control-group">
                    <label>
                        ç‰©ä½“è·ç¦» D (ç±³)
                        <span class="value-display" id="objectValue">5.0 m</span>
                    </label>
                    <input type="range" id="objectDistance" min="1" max="20" step="0.1" value="5">
                </div>
                
                <div class="control-group">
                    <label>
                        ç„¦è· f (mm)
                        <span class="value-display" id="focalValue">2 mm</span>
                    </label>
                    <input type="range" id="focalLength" min="1.0" max="20.0" step="0.01" value="2.0">
                </div>
                
                <div class="control-group">
                    <label>
                        å…‰åœˆ f/N
                        <span class="value-display" id="apertureValue">f/2.8</span>
                    </label>
                    <input type="range" id="aperture" min="1.4" max="22" step="0.1" value="2.8">
                </div>
            </div>
            
            <div class="visualization">
                <h3 style="margin-bottom: 15px; color: #333;">ğŸ¯ å…‰å­¦ç¤ºæ„å›¾</h3>
                <canvas id="opticsCanvas" width="500" height="400"></canvas>
            </div>
        </div>
        
        <div class="result-box">
            <h3>å¼¥æ•£åœ†ç›´å¾„ (CoC)</h3>
            <div class="result-value" id="cocResult">0.000 mm</div>
        </div>
        
        <div class="explanation">
            <h4>ğŸ’¡ å…¬å¼è¯´æ˜</h4>
            <p>
                <strong>å¼¥æ•£åœ†ï¼ˆCircle of Confusionï¼‰</strong>æ˜¯è¡¡é‡å›¾åƒæ¸…æ™°åº¦çš„é‡è¦æŒ‡æ ‡ã€‚å½“ç‰©ä½“ä¸åœ¨å¯¹ç„¦å¹³é¢ä¸Šæ—¶ï¼Œ
                å®ƒåœ¨æˆåƒå¹³é¢ä¸Šä¼šå½¢æˆä¸€ä¸ªæ¨¡ç³Šçš„åœ†æ–‘è€Œä¸æ˜¯æ¸…æ™°çš„ç‚¹ã€‚CoCå€¼è¶Šå°ï¼Œå›¾åƒè¶Šæ¸…æ™°ã€‚
            </p>
            <p style="margin-top: 10px;">
                <strong>å‚æ•°å«ä¹‰ï¼š</strong><br>
                â€¢ Sï¼šå¯¹ç„¦è·ç¦»ï¼ˆç›¸æœºå¯¹ç„¦çš„ä½ç½®ï¼‰<br>
                â€¢ Dï¼šç‰©ä½“å®é™…è·ç¦»<br>
                â€¢ fï¼šé•œå¤´ç„¦è·<br>
                â€¢ Nï¼šå…‰åœˆå€¼ï¼ˆf-numberï¼‰<br>
                å½“CoCå°äºä¼ æ„Ÿå™¨çš„å¯æ¥å—å¼¥æ•£åœ†æ—¶ï¼Œç‰©ä½“è¢«è®¤ä¸ºæ˜¯"æ¸…æ™°"çš„ï¼Œè¿™å°±æ˜¯æ™¯æ·±çš„åŸºç¡€ã€‚
            </p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('opticsCanvas');
        const ctx = canvas.getContext('2d');
        
        const focusSlider = document.getElementById('focusDistance');
        const objectSlider = document.getElementById('objectDistance');
        const focalSlider = document.getElementById('focalLength');
        const apertureSlider = document.getElementById('aperture');
        
        function calculate() {
            const S = parseFloat(focusSlider.value);
            const D = parseFloat(objectSlider.value);
            const f = parseFloat(focalSlider.value) / 1000; // è½¬æ¢ä¸ºç±³
            const N = parseFloat(apertureSlider.value);
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('focusValue').textContent = S.toFixed(1) + ' m';
            document.getElementById('objectValue').textContent = D.toFixed(1) + ' m';
            document.getElementById('focalValue').textContent = focalSlider.value + ' mm';
            document.getElementById('apertureValue').textContent = 'f/' + N.toFixed(1);
            
            // è®¡ç®—å¼¥æ•£åœ†
            const numerator = Math.abs(D - S) / D;
            const denominator = N * (S - f);
            const CoC = numerator * (f * f) / denominator;
            
            // è½¬æ¢ä¸ºæ¯«ç±³
            const CoCmm = CoC * 1000;
            
            document.getElementById('cocResult').textContent = CoCmm.toFixed(3) + ' mm';
            
            drawVisualization(S, D, f * 1000, N, CoCmm);
        }
        
        function drawVisualization(S, D, f, N, CoC) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const scale = 40;
            const lensX = 250;
            const lensY = 200;
            
            // ç»˜åˆ¶é•œå¤´
            ctx.fillStyle = '#667eea';
            ctx.beginPath();
            ctx.ellipse(lensX, lensY, 15, 60, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // ç»˜åˆ¶å…‰è½´
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.moveTo(0, lensY);
            ctx.lineTo(canvas.width, lensY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // ç»˜åˆ¶ç‰©ä½“ï¼ˆå¯¹ç„¦ç‚¹ï¼‰
            const focusX = lensX - S * scale;
            ctx.fillStyle = '#4caf50';
            ctx.beginPath();
            ctx.moveTo(focusX, lensY - 40);
            ctx.lineTo(focusX, lensY + 40);
            ctx.lineTo(focusX - 10, lensY + 40);
            ctx.lineTo(focusX - 10, lensY - 40);
            ctx.closePath();
            ctx.fill();
            
            // ç»˜åˆ¶ç‰©ä½“æ ‡ç­¾
            ctx.fillStyle = '#4caf50';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('å¯¹ç„¦ç‚¹', focusX - 25, lensY - 50);
            
            // ç»˜åˆ¶å®é™…ç‰©ä½“
            const objectX = lensX - D * scale;
            ctx.fillStyle = '#f44336';
            ctx.beginPath();
            ctx.moveTo(objectX, lensY - 40);
            ctx.lineTo(objectX, lensY + 40);
            ctx.lineTo(objectX - 10, lensY + 40);
            ctx.lineTo(objectX - 10, lensY - 40);
            ctx.closePath();
            ctx.fill();
            
            ctx.fillStyle = '#f44336';
            ctx.fillText('ç‰©ä½“', objectX - 20, lensY - 50);
            
            // ç»˜åˆ¶ä¼ æ„Ÿå™¨/æˆåƒé¢
            const sensorX = lensX + 80;
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.moveTo(sensorX, lensY - 60);
            ctx.lineTo(sensorX, lensY + 60);
            ctx.stroke();
            
            ctx.fillStyle = '#333';
            ctx.font = 'bold 12px Arial';
            ctx.fillText('ä¼ æ„Ÿå™¨', sensorX - 10, lensY + 75);
            
            // ç»˜åˆ¶å…‰çº¿ï¼ˆä»ç‰©ä½“åˆ°é•œå¤´åˆ°ä¼ æ„Ÿå™¨ï¼‰
            const apertureRadius = 60 / N;
            
            // ä¸Šå…‰çº¿
            ctx.strokeStyle = 'rgba(244, 67, 54, 0.6)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(objectX, lensY - 40);
            ctx.lineTo(lensX, lensY - apertureRadius);
            ctx.lineTo(sensorX, lensY + CoC * 10);
            ctx.stroke();
            
            // ä¸‹å…‰çº¿
            ctx.beginPath();
            ctx.moveTo(objectX, lensY - 40);
            ctx.lineTo(lensX, lensY + apertureRadius);
            ctx.lineTo(sensorX, lensY - CoC * 10);
            ctx.stroke();
            
            // ç»˜åˆ¶å¼¥æ•£åœ†
            const cocRadius = Math.min(CoC * 10, 50);
            ctx.fillStyle = 'rgba(244, 67, 54, 0.3)';
            ctx.beginPath();
            ctx.ellipse(sensorX, lensY, 3, cocRadius, 0, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#f44336';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // æ·»åŠ å…‰åœˆæ ‡è®°
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(lensX - 5, lensY - apertureRadius);
            ctx.lineTo(lensX + 5, lensY - apertureRadius);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(lensX - 5, lensY + apertureRadius);
            ctx.lineTo(lensX + 5, lensY + apertureRadius);
            ctx.stroke();
        }
        
        // äº‹ä»¶ç›‘å¬
        focusSlider.addEventListener('input', calculate);
        objectSlider.addEventListener('input', calculate);
        focalSlider.addEventListener('input', calculate);
        apertureSlider.addEventListener('input', calculate);
        
        // åˆå§‹åŒ–
        calculate();
    </script>
</body>
</html>